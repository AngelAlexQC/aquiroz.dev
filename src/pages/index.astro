---
// Only redirect if no specific locale preference is stored
// This allows search engines to index the root page properly
const hasLocalePreference = Astro.cookies.get("locale-preference");

if (!hasLocalePreference) {
  // Detect user's preferred language only on first visit
  const preferredLocale = Astro.preferredLocale;
  let redirectLocale = "es"; // default fallback

  if (preferredLocale) {
    if (preferredLocale.startsWith("es")) {
      redirectLocale = "es";
    } else {
      redirectLocale = "en";
    }
  }

  // Set cookie to remember preference and redirect
  Astro.cookies.set("locale-preference", redirectLocale, {
    maxAge: 60 * 60 * 24 * 30, // 30 days
    path: "/",
  });

  return Astro.redirect(`/${redirectLocale}/`, 302); // Temporary redirect
}

// If user has visited before, show language selection page
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>Ángel Quiroz - Senior Software Engineer</title>
    <meta
      name="description"
      content="Senior Software Engineer specializing in Full Stack development, Technical Leadership, and Software Architecture. Choose your preferred language."
    />
    <link rel="canonical" href="https://aquiroz.dev/" />
    <link rel="alternate" hreflang="es" href="https://aquiroz.dev/es/" />
    <link rel="alternate" hreflang="en" href="https://aquiroz.dev/en/" />
    <link rel="alternate" hreflang="x-default" href="https://aquiroz.dev/" />
  </head>
  <body
    class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen flex items-center justify-center font-sans">
    <div class="text-center max-w-md mx-auto p-8">
      <div class="mb-8">
        <h1 class="text-4xl font-bold text-gray-900 mb-4">Ángel Quiroz</h1>
        <p class="text-gray-600">Senior Software Engineer</p>
      </div>

      <div class="space-y-4">
        <a
          href="/es/"
          class="block w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 transition-colors">
          🇪🇸 Español
        </a>
        <a
          href="/en/"
          class="block w-full bg-gray-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-gray-700 transition-colors">
          🇺🇸 English
        </a>
      </div>
    </div>
  </body>
</html>
